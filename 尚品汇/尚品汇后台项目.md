#    组件通信方式

## 基础六种通信方式

1. props

   注意：如果父组件给子组件传递数据（函数），本质其实就是子组件给父组件传数据

   如果父组件给子组件传递的数据（非函数），本质就是父组件给子组件传递数据

   书写方式：

   - `['todos']`
   - `{type:Array}`
   - `{type:Array,default:[]}`

2. 自定义事件

   适用于子传父

   $on 和 $emit

3. 全局事件总线$bus

   Vue.prototype.$bus = this

4. pubsub-js，在 react 框架中用的比较多（发布与订阅）

5. Vuex：万能

6. 插槽：适用于父子组件通信

## 高级组件通信

### 事件

1. 原生DOM（button）是可以绑定系统事件的（click）

   组件标签（子组件）可以绑定系统事件（click），但是不起作用，原因是这个属于自定义事件

   解决方法：`@click.native`把自定义事件变为原生的DOM事件，其实就是给子组件的根节点绑定单击事件，利用了事件的委派

   ```vue
   <template>
   	<div>
           <Event @click="handle"></Event>
       </div>
   </template>
   <script>
   	export default {
   		components:{
               Event
           },
           methods: {
   			handle (){
                   console.log("handle事件被触发")
               }
           }
       }
   </script>
   ```

   如图所示，如果给子组件绑定@click 事件，Vue会将其当成自定义事件，等待子组件中使用 $emit 触发，如果想要告诉Vue这是一个原生事件，那么只需要加上`@click.native`即可

   在事件中，给原生DOM绑定自定义节点是没有意义的，例如：`<button @xxx="handle">Click</button>`，我们无法让原生DOM触发 $emit 事件

### $attrs与$listeners

通过 `$attrs`可以获取到父组件传给的数据

对于子组件而言，父组件给的数据可以利用 props 接收，如果子组件通过 props 接收的属性，在 $attrs 属性当中是获取不到的

通过 `$listeners` 可以获取到组件实例自身的一个属性，它可以获取到父组件给子组件传递自定义事件

子组件：

```vue
<template>
	<el-button v-bind="$attrs" v-on="$listeners"></el-button>
</template>
<script>
	export default {}
</script>
```

注意这里不能用 @ 或者 ：等语法糖写法代替

### 属性修饰符sync

可以实现父子组件数据同步

`:money.sync = money` 代表父组件给字符串传递 props【money】 给当前子组件绑定一个自定义事件（update：money）

### v-model

实现原理：value 与 input 事件实现，还需要注意可以通过 v-model 实现父子组件数据同步

### $children 与 $parent 

组件身上有一个属性 $children 可以获取到这个组件的所有子组件【数组】，可以使用 forEach() 进行遍历 ，`this.$children.forEach(item=>{item.data = data})`

也可以使用 ref 为子组件打上点，然后通过 this.$refs.xx.data 来操作子组件的数据

子组件身上有一个 $parent 属性，通过这个属性可以找到此组件的父组件，可以操作父组件的数据和方法，`this.$parent.data = data`

### 混入mixin

如果项目当中出现很多结构类似功能，想到组件复用

如果项目当中很多的组件JS业务逻辑相似，想到mixin。【可以把一些相同的功能封装起来】

使用`export.default`导出，然后在需要使用这个地方的位置使用`import`导入

然后使用`mixins`关键字，即可使用

在`mixin`中，可以实现很多，比如`mounted, created`也可以使用。

具体代码：

myMixin.js

```js
export default {
    methods: {
        giveMoney(money){
            this.money -= money;
            this.$parent.money += money;
        }
    }
}
```

Daughter.vue

```vue
<template>
	<div>
        <button @click="giveMoney(100)">给钱</button>
    </div>
</template>
<script>
	import myMixin from "url"
    export default {
        name:"Daughter",
        mixins:[myMixin],
        data() {
            return {
                money:2000
            }
        }
    }
</script>
```

# 后台管理项目

## 创建项目

这里我们使用`vue-admin-template`这个项目，项目地址：`https://github.com/PanJiaChen/vue-admin-template`

然后使用`npm install`安装依赖

分析页面结构：

```bash
|_build
  |_index.js webpack配置文件（很少会修改这个文件）
|_mock --mock数据的文件夹，模拟一些假数据使用 mock.js 实现
|_mode_modules --项目以来模块
|_public --ico图标，静态页面，public文件夹里边经常放置一些静态资源，而且在项目打包时不会编译这个文件夹，原封不动的打包到dist文件夹中
|_src --程序员源代码
  |_api --封装请求接口
  |_access -accets文件夹，里边防止一些静态资源（一般是共享的），放在这个文件夹中，在打包时，会进行编译
  |_components --放置一些非路由组件获取全局组件
  |_icons --放置一些svg矢量图
  |_layout文件夹 --放置一些组件和混入
  |_router --与路由相关的
  |_style --与样式相关的
  |_utils --request.js是axios的二次封装
  |_view --路由组件
  |_settings --配置文件
  |_permission.js --路由守卫
  |_main.js --入口文件
  |_app.vue --根组件
还有其他的一些文件，就不一一列举了，都不碰
```

